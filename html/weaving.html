<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>weaving </title>
    <style>
        html,
        body {
            margin: 0;
            height: 100%;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <canvas></canvas>

    <script>
        const canvas = document.querySelector("canvas");
        const gl = canvas.getContext("webgl2");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        gl.viewport(0, 0, canvas.width, canvas.height);


        function createShader(gl, type, source) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            return shader;
        }

        const vertex =
            `#version 300 es
             in vec4 a_position;
             void main() {
                gl_Position = a_position;
             }`

        const scale = (Math.min(innerWidth, innerHeight) / 20).toFixed(1)

        const fragment =
            `#version 300 es
            precision highp float;
            out vec4 fragColor;
            uniform float iTime;

            void main() {
                vec2 uv = gl_FragCoord.xy / ${scale};

                ivec2 v = ivec2(uv + iTime);
                ivec2 i = v / 5;
                v %= 5;

                int k = v.y / 3 * 2 + v.x / 3;
                if(k == 0) k = (i.x + i.y) % 2;

                vec4 colors[4] = vec4[](
                    vec4(0., 1., .7, 1.),
                    vec4(1.0, 0.7, 0., 1.0),
                    vec4(0., 1., .7, 1.),   
                    vec4(0., 0., 0., 1.)
                );
                fragColor = colors[k];
            }
        `

        const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertex);
        const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragment);

        function createProgram(gl, vs, fs) {
            const program = gl.createProgram();
            gl.attachShader(program, vs);
            gl.attachShader(program, fs);
            gl.linkProgram(program);
            return program;
        }

        const program = createProgram(gl, vertexShader, fragmentShader);
        gl.useProgram(program);

        // Fullscreen quad
        const posBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, posBuffer);
        const vertices = new Float32Array([
            -1, -1,
            1, -1,
            -1, 1,
            1, 1,
        ]);
        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);

        const posLoc = gl.getAttribLocation(program, "a_position");
        gl.enableVertexAttribArray(posLoc);
        gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);

        const iTimeLoc = gl.getUniformLocation(program, "iTime");

        function render(time) {
            gl.uniform1f(iTimeLoc, time / 1000 * 4);

            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
            requestAnimationFrame(render);
        }

        render();
    </script>
</body>

</html>