<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>eclipse</title>
    <style>
        html,
        body {
            margin: 0;
            height: 100%;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <canvas></canvas>

    <script>
        const canvas = document.querySelector("canvas");
        const gl = canvas.getContext("webgl2");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        gl.viewport(0, 0, innerWidth, innerHeight);


        function createShader(gl, type, source) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            return shader;
        }

        const vertex =
            `#version 300 es
             in vec4 a_position;
             void main() {
                gl_Position = a_position;
             }
        `

        const min = Math.min(innerWidth, innerHeight).toFixed(1)

        const [x, y] = innerWidth > innerHeight ? [0.75, '0.'] : ['0.', 0.75]

        const fragment =
            `#version 300 es
            precision highp float;
            out vec4 fragColor;
            uniform float iTime;

            vec2 iResolution = vec2(${innerWidth}, ${innerHeight});

            void main() {
                vec2 uv = 1.5*(2.0*gl_FragCoord.xy - iResolution) / ${min};
                vec2 offset = vec2(cos(iTime)*${x}, sin(iTime)*${y});
                float light = 0.1 / distance(normalize(uv), uv);
                
                if(length(uv) < 1.0)
                    light *= 0.1 / distance(normalize(uv-offset), uv-offset);

                fragColor = vec4(light * vec3(0.9, 0.65, 0.5), 1.0);
            }
        `

        const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertex);
        const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragment);

        function createProgram(gl, vs, fs) {
            const program = gl.createProgram();
            gl.attachShader(program, vs);
            gl.attachShader(program, fs);
            gl.linkProgram(program);
            return program;
        }

        const program = createProgram(gl, vertexShader, fragmentShader);
        gl.useProgram(program);

        // Fullscreen quad
        const posBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, posBuffer);
        const vertices = new Float32Array([
            -1, -1,
            1, -1,
            -1, 1,
            1, 1,
        ]);
        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);

        const posLoc = gl.getAttribLocation(program, "a_position");
        gl.enableVertexAttribArray(posLoc);
        gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);

        const iTimeLoc = gl.getUniformLocation(program, "iTime");

        function render(time) {
            gl.uniform1f(iTimeLoc, time / 1000 * 2);

            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
            requestAnimationFrame(render);
        }

        render();
    </script>
</body>

</html>